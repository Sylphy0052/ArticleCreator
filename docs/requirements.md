# 要件定義書

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | ArticleCreator |
| バージョン | 1.2.0 |
| 最終更新日 | 2026-01-05 |
| ステータス | Released |

## 目次

1. [概要](#概要)
2. [ユーザーストーリー](#ユーザーストーリー)
3. [機能要件](#機能要件)
4. [非機能要件](#非機能要件)
5. [制約事項](#制約事項)
6. [トレーサビリティマトリクス](#トレーサビリティマトリクス)

---

## 概要

### 背景

エンジニア向け技術記事の制作には、調査・執筆・画像作成・資料化など多くの工程があり、それぞれ異なるツールを使い分ける必要がある。これらの工程間の情報伝達やファイル管理が煩雑で、制作リードタイムが長くなっている。

### 目的

Google Apps Script (GAS) をハブとして、Gemini Gems の調査・生成能力と NotebookLM の資料構成能力を統合した自律型コンテンツ制作パイプラインを構築し、エンジニア向け高品質記事の制作リードタイムを劇的に短縮する。

### スコープ

**含まれるもの:**

- Phase 1: 基盤構築（サイドバーUI、設定管理、プロンプト生成）
- Phase 2: データ保存・整理（Drive連携、履歴保存）
- Phase 3: メディア連携（画像・PDF管理、manifest生成）

**含まれないもの:**

- モバイル対応（PC操作前提）
- 自動投稿機能（各プラットフォームへの自動投稿）
- 複数ユーザー同時編集機能

---

## ユーザーストーリー

### US-001: テーマに基づく調査プロンプト生成

**As a** コンテンツ制作者
**I want** テーマを入力するだけで調査用プロンプトを自動生成したい
**So that** 調査の効率化と品質の均一化を実現できる

**受入基準:**

- [x] テーマ入力フィールドが提供される
- [x] 入力したテーマに基づいて調査用プロンプトが生成される
- [x] 生成されたプロンプトをコピーできる
- [x] Gem A のURLを開くボタンが提供される

### US-002: ターゲット・トーンに応じた執筆プロンプト生成

**As a** コンテンツ制作者
**I want** ターゲット読者とトーンを選択して執筆プロンプトを生成したい
**So that** 読者に最適化された記事を効率的に作成できる

**受入基準:**

- [x] ターゲット選択肢（エンジニア・デザイナー・PM・非技術者）が提供される
- [x] トーン選択肢（カジュアル・フォーマル・技術的・教育的・実践的・解説的・フレンドリー・ビジネスライク・アカデミック）が提供される
- [x] 調査結果の有無に応じてプロンプトが自動切替される
- [x] 生成されたプロンプトをコピーできる
- [x] Gem B のURLを開くボタンが提供される

### US-003: 作業状態の保存と復元

**As a** コンテンツ制作者
**I want** ブラウザを閉じても前回の続きから再開したい
**So that** 作業の中断・再開を柔軟に行える

**受入基準:**

- [x] 入力内容が自動保存される
- [x] 再度開いた際に前回の状態が復元される
- [x] 新規作成（リセット）機能も提供される

### US-004: 成果物のDrive保存

**As a** コンテンツ制作者
**I want** 全ての成果物を整理されたフォルダ構造でDriveに保存したい
**So that** 成果物の管理と再利用が容易になる

**受入基準:**

- [x] 日付・テーマ名・バージョン番号を含むフォルダが自動作成される
- [x] 調査結果、記事、画像、PDFが所定のファイル名で保存される
- [x] manifest.jsonにメタデータが記録される

### US-005: 設定の永続化

**As a** コンテンツ制作者
**I want** Gem URLと保存先フォルダIDを設定画面で管理したい
**So that** 環境設定を一度行えば繰り返し利用できる

**受入基準:**

- [x] 4つのGem URL（Research/Writing/Nanobanana/Slides）を設定できる
- [x] 保存先Google Drive親フォルダIDを設定できる
- [x] 設定値が永続化される

### US-006: 画像プロンプト生成とアップロード

**As a** コンテンツ制作者
**I want** 記事内容に基づいた画像生成プロンプトを自動生成し、生成した画像をアップロードしたい
**So that** 記事に最適なアイキャッチ画像を効率的に作成・管理できる

**受入基準:**

- [x] 記事内容とトーンに基づいて画像プロンプトが生成される
- [x] Nanobanana用の日本語プロンプトが出力される
- [x] 生成されたプロンプトをコピーできる
- [x] Gem C（Nanobanana）のURLを開くボタンが提供される
- [x] 生成した画像をファイル選択でアップロードできる
- [x] アップロードした画像がプレビュー表示される

### US-007: スライド資料の構成とPDF管理

**As a** コンテンツ制作者
**I want** スライド構成プロンプトを生成し、NotebookLMで作成したPDFをアップロードしたい
**So that** 記事内容を資料化してプレゼンテーションに活用できる

**受入基準:**

- [x] スライド構成プロンプトが生成される
- [x] Gem D（Slides）のURLを開くボタンが提供される
- [x] NotebookLM連携の手順が画面に表示される
- [x] 生成したPDFをファイル選択でアップロードできる

### US-008: ワークフロー完了と成果物整理

**As a** コンテンツ制作者
**I want** 全ての成果物を一括でDriveに保存し、作業を完了したい
**So that** 成果物が整理された状態で保存され、次のプロジェクトに移れる

**受入基準:**

- [x] 完了タブで全成果物の保存状況が確認できる
- [x] 必須ファイル（記事）が不足している場合は警告が表示される
- [x] 「全て保存」ボタンで一括保存が実行される
- [x] 保存完了後にフォルダURLが表示される
- [x] 新規作成（リセット）機能が提供される

---

## 機能要件

### 調査機能（Phase 1）

#### REQ-001: テーマ入力機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-001 |

**要件:** システムは、ユーザーがテーマをテキストフィールドに入力できる機能を提供しなければならない。

**受入基準:**

- [x] テキスト入力フィールドが表示される
- [x] 入力内容が PropertiesService に自動保存される

#### REQ-002: 調査プロンプト生成機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-001 |

**要件:** ユーザーがテーマを入力した時、システムは調査用プロンプトを自動生成しなければならない。

**受入基準:**

- [x] テンプレートに基づいてプロンプトが生成される
- [x] 生成されたプロンプトが画面に表示される

#### REQ-003: Gem連携ボタン機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-001, US-002 |

**要件:** システムは、生成されたプロンプトをコピーするボタンと、対応するGemのURLを開くボタンの両方を提供しなければならない。

**受入基準:**

- [x] 「コピー」ボタンでプロンプトがクリップボードにコピーされる
- [x] 「Gemを開く」ボタンで設定済みのGem URLが新しいタブで開く

### 執筆機能（Phase 1）

#### REQ-004: ターゲット選択機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-002 |

**要件:** システムは、ターゲット読者を選択するUIを提供しなければならない。

**受入基準:**

- [x] エンジニア・デザイナー・PM・非技術者の選択肢が表示される
- [x] 選択内容が保存される

#### REQ-005: トーン選択機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-002 |

**要件:** システムは、記事のトーンを選択するUIを提供しなければならない。

**受入基準:**

- [x] カジュアル・フォーマル・技術的・教育的・実践的・解説的・フレンドリー・ビジネスライク・アカデミックの選択肢が表示される
- [x] 選択内容が保存される

#### REQ-006: 執筆プロンプト生成機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-002 |

**要件:** もし調査結果が存在するならば、システムは「事実準拠」のプロンプトを生成しなければならない。もし調査結果が存在しないならば、システムは「AI知識補完」のプロンプトを生成しなければならない。

**受入基準:**

- [x] 調査結果有無を判定するロジックが実装される
- [x] 適切なテンプレートが選択される
- [x] ターゲット・トーンがプロンプトに反映される

### 設定機能（Phase 1）

#### REQ-007: URL設定機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-005 |

**要件:** システムは、4つのGem URL（Research/Writing/Nanobanana/Slides）を設定・保存できる機能を提供しなければならない。

**受入基準:**

- [x] 各Gem URLの入力フィールドが提供される
- [x] 入力値が PropertiesService に保存される
- [x] 保存済みの値が次回起動時に復元される

#### REQ-008: フォルダID設定機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-005 |

**要件:** システムは、保存先Google Drive親フォルダIDを設定・保存できる機能を提供しなければならない。

**受入基準:**

- [x] フォルダIDの入力フィールドが提供される
- [x] 入力値が PropertiesService に保存される

### データ保存機能（Phase 2）

#### REQ-009: フォルダ自動生成機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-004 |

**要件:** ユーザーが保存を実行した時、システムは `[yyyyMMdd_テーマ名_vX]` 形式のフォルダをDriveに自動作成しなければならない。

**受入基準:**

- [x] 日付がyyyyMMdd形式で付与される
- [x] テーマ名がフォルダ名に含まれる
- [x] 同一テーマの場合はバージョン番号が自動インクリメントされる

#### REQ-010: ファイル保存機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-004 |

**要件:** システムは、調査結果・記事・画像・PDFを所定のファイル名で保存しなければならない。

**受入基準:**

- [x] 01_research_results.md として調査結果が保存される
- [x] 02_theme_article.md として記事が保存される
- [x] 03_thumbnail.png として画像が保存される
- [x] 04_presentation.pdf としてPDFが保存される

#### REQ-011: 履歴保存（レジュメ）機能

| 項目 | 内容 |
|------|------|
| 優先度 | Medium |
| ユーザーストーリー | US-003 |

**要件:** システムは、ユーザーの入力内容を PropertiesService に随時オートセーブしなければならない。

**受入基準:**

- [x] 各フィールドの変更時に自動保存される
- [x] 再起動時に保存内容が復元される

### 視覚化機能（Phase 3）

#### REQ-012: 画像プロンプト生成機能

| 項目 | 内容 |
|------|------|
| 優先度 | Medium |
| ユーザーストーリー | US-006 |

**要件:** ユーザーが画像タブを表示した時、システムは記事内容とトーンに基づいてNanobanana用の画像プロンプトを生成しなければならない。

**受入基準:**

- [x] 記事内容が存在する場合にプロンプトが生成される
- [x] トーン設定がプロンプトに反映される
- [x] 日本語でプロンプトが出力される
- [x] 比率16:9が指定される

#### REQ-013: 画像アップロード機能

| 項目 | 内容 |
|------|------|
| 優先度 | Medium |
| ユーザーストーリー | US-006 |

**要件:** ユーザーがNanobananaで生成した画像をPCから選択した時、システムはその画像をプレビュー表示し、Driveへの保存対象として登録しなければならない。

**受入基準:**

- [x] ファイル選択UI（input type="file" accept="image/*"）が提供される
- [x] 選択した画像がプレビュー表示される
- [x] 画像データがBase64形式で保持される

### 資料化機能（Phase 3）

#### REQ-014: スライド構成プロンプト生成機能

| 項目 | 内容 |
|------|------|
| 優先度 | Medium |
| ユーザーストーリー | US-007 |

**要件:** ユーザーが資料タブを表示した時、システムは記事内容に基づいてスライド構成プロンプトを生成しなければならない。

**受入基準:**

- [x] 記事内容が存在する場合にプロンプトが生成される
- [x] Gem D（Slides）のURLを開くボタンが提供される
- [x] NotebookLM連携手順が画面に表示される

#### REQ-015: PDFアップロード機能

| 項目 | 内容 |
|------|------|
| 優先度 | Medium |
| ユーザーストーリー | US-007 |

**要件:** ユーザーがNotebookLMで生成したPDFをPCから選択した時、システムはそのPDFをDriveへの保存対象として登録しなければならない。

**受入基準:**

- [x] ファイル選択UI（input type="file" accept="application/pdf"）が提供される
- [x] PDFデータがBase64形式で保持される

### 完了機能（Phase 2-3）

#### REQ-016: 成果物一括保存機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-008 |

**要件:** ユーザーが「全て保存」ボタンをクリックした時、システムはすべての成果物をDriveフォルダに一括保存しなければならない。

**受入基準:**

- [x] 調査結果が 01_research_results.md として保存される
- [x] 記事が 02_theme_article.md として保存される
- [x] 画像が 03_thumbnail.png として保存される
- [x] PDFが 04_presentation.pdf として保存される
- [x] manifest.json が生成・保存される

#### REQ-017: 保存前バリデーション機能

| 項目 | 内容 |
|------|------|
| 優先度 | High |
| ユーザーストーリー | US-008 |

**要件:** もし必須ファイル（記事）が存在しないならば、システムは保存をブロックし警告を表示しなければならない。もし保存先フォルダIDが未設定ならば、システムは保存をブロックし設定を促すメッセージを表示しなければならない。

**受入基準:**

- [x] 記事が空の場合は保存がブロックされる
- [x] 保存先フォルダID未設定時は保存がブロックされる
- [x] 警告メッセージが画面に表示される

#### REQ-018: manifest.json生成機能

| 項目 | 内容 |
|------|------|
| 優先度 | Medium |
| ユーザーストーリー | US-004, US-008 |

**要件:** システムは、保存時にmanifest.jsonを生成し、メタデータを記録しなければならない。

**受入基準:**

- [x] 作成日時（ISO 8601形式）が記録される
- [x] テーマ、ターゲット、トーンが記録される
- [x] 調査結果有無（hasResearch）が記録される
- [x] 各ファイル名が記録される
- [x] 使用プロンプトが記録される

#### REQ-019: 状態リセット機能

| 項目 | 内容 |
|------|------|
| 優先度 | Medium |
| ユーザーストーリー | US-008 |

**要件:** ユーザーが「新規作成」ボタンをクリックした時、システムは確認ダイアログを表示し、承認後に全ての作業状態をクリアしなければならない。

**受入基準:**

- [x] 確認ダイアログが表示される
- [x] 承認後に全フィールドがクリアされる
- [x] PropertiesService の状態データがクリアされる

---

## 非機能要件

### パフォーマンス

#### NFR-001: UI応答速度

| 項目 | 内容 |
|------|------|
| カテゴリ | パフォーマンス |
| 優先度 | High |

**要件:** システムは、ユーザー操作に対して2秒以内に応答しなければならない。

**測定方法:** 各操作の応答時間を計測し、95パーセンタイルが2秒以内であることを確認する。

#### NFR-002: プロンプト生成速度

| 項目 | 内容 |
|------|------|
| カテゴリ | パフォーマンス |
| 優先度 | Medium |

**要件:** システムは、プロンプト生成を500ミリ秒以内に完了しなければならない。

**測定方法:** generateResearchPrompt、generateWritingPrompt等の実行時間を計測する。

### セキュリティ

#### NFR-003: 認証・認可

| 項目 | 内容 |
|------|------|
| カテゴリ | セキュリティ |
| 優先度 | High |

**要件:** システムは、Googleアカウント認証によるアクセス制御を行わなければならない。

**測定方法:** 未認証ユーザーがアクセスできないことを確認する。

#### NFR-004: データ分離

| 項目 | 内容 |
|------|------|
| カテゴリ | セキュリティ |
| 優先度 | High |

**要件:** システムは、UserPropertiesを使用してユーザーごとにデータを分離しなければならない。

**測定方法:** 異なるユーザーが他ユーザーのデータにアクセスできないことを確認する。

### 可用性

#### NFR-005: データ永続性

| 項目 | 内容 |
|------|------|
| カテゴリ | 可用性 |
| 優先度 | High |

**要件:** システムは、ユーザーの入力データと設定をPropertiesServiceに永続化しなければならない。

**測定方法:** ブラウザ再起動後にデータが復元されることを確認する。

#### NFR-006: オートセーブ頻度

| 項目 | 内容 |
|------|------|
| カテゴリ | 可用性 |
| 優先度 | Medium |

**要件:** システムは、ユーザー入力を500ミリ秒のデバウンス後に自動保存しなければならない。

**測定方法:** 入力停止後500ms以内にPropertiesServiceへの保存が実行されることを確認する。

### ユーザビリティ

#### NFR-007: 一貫したUIデザイン

| 項目 | 内容 |
|------|------|
| カテゴリ | ユーザビリティ |
| 優先度 | High |

**要件:** システムは、Google Material Design Lite（MDL 1.3.0）に準拠したUIを提供しなければならない。

**測定方法:** Material Design Liteコンポーネントが正しく適用されていることを目視確認する。

#### NFR-008: フィードバック表示

| 項目 | 内容 |
|------|------|
| カテゴリ | ユーザビリティ |
| 優先度 | Medium |

**要件:** システムは、保存成功・エラー発生時にトースト通知を表示しなければならない。

**測定方法:** 各操作後に適切な通知が表示されることを確認する。

#### NFR-009: タブナビゲーション

| 項目 | 内容 |
|------|------|
| カテゴリ | ユーザビリティ |
| 優先度 | High |

**要件:** システムは、5タブ構成（調査/執筆/画像/資料/完了）のナビゲーションを提供しなければならない。

**測定方法:** 全タブが表示され、クリックで切り替わることを確認する。

### 保守性

#### NFR-010: 単一ファイル構成

| 項目 | 内容 |
|------|------|
| カテゴリ | 保守性 |
| 優先度 | High |

**要件:** システムは、単一ファイル（Code.gs + HTML/CSSインライン）で構成されなければならない。

**測定方法:** プロジェクト構成がCode.gsのみであることを確認する。

---

## 制約事項

### 技術的制約

- 単一ファイル構成（Code.gs）で実装する
- Google Apps Script の実行時間制限（6分）に従う
- PropertiesService のサイズ制限（9KB/プロパティ、500KB/全体）に従う

### ビジネス制約

- PC操作を前提とする（モバイル非対応）
- 日本語UIのみ対応

### 規制・コンプライアンス

- Google Drive API の利用規約に従う
- Gemini Gems の利用規約に従う

---

## 用語集

| 用語 | 定義 |
|------|------|
| GAS | Google Apps Script。Google Workspaceの自動化・拡張用スクリプト環境 |
| Gem | Gemini Gems。カスタマイズされたGeminiのインスタンス |
| NotebookLM | Googleの資料統合・生成ツール |
| Nanobanana | 画像生成用のGem |
| Deep Research | Geminiの詳細調査機能 |
| Material Design Lite | Googleの軽量UIフレームワーク |
| PropertiesService | GASのデータ永続化サービス |

---

## トレーサビリティマトリクス

### ユーザーストーリー - 機能要件マッピング

| ユーザーストーリー | 関連する機能要件 | Phase |
|-------------------|-----------------|-------|
| US-001 | REQ-001, REQ-002, REQ-003 | 1 |
| US-002 | REQ-004, REQ-005, REQ-006, REQ-003 | 1 |
| US-003 | REQ-011 | 2 |
| US-004 | REQ-009, REQ-010, REQ-016, REQ-018 | 2-3 |
| US-005 | REQ-007, REQ-008 | 1 |
| US-006 | REQ-012, REQ-013 | 3 |
| US-007 | REQ-014, REQ-015 | 3 |
| US-008 | REQ-016, REQ-017, REQ-018, REQ-019 | 2-3 |

### 機能要件 - 非機能要件マッピング

| 機能要件 | 関連する非機能要件 |
|---------|-------------------|
| REQ-001 - REQ-006 | NFR-001, NFR-002, NFR-007 |
| REQ-007, REQ-008 | NFR-003, NFR-004, NFR-005, NFR-008 |
| REQ-009, REQ-010 | NFR-001, NFR-003 |
| REQ-011 | NFR-005, NFR-006 |
| REQ-012 - REQ-015 | NFR-001, NFR-007, NFR-008 |
| REQ-016 - REQ-019 | NFR-001, NFR-003, NFR-008 |
| 全要件 | NFR-007, NFR-009, NFR-010 |

### Phase別要件一覧

#### Phase 1: 基盤構築

| ID | 要件名 | 優先度 |
|----|-------|-------|
| REQ-001 | テーマ入力機能 | High |
| REQ-002 | 調査プロンプト生成機能 | High |
| REQ-003 | Gem連携ボタン機能 | High |
| REQ-004 | ターゲット選択機能 | High |
| REQ-005 | トーン選択機能 | High |
| REQ-006 | 執筆プロンプト生成機能 | High |
| REQ-007 | URL設定機能 | High |
| REQ-008 | フォルダID設定機能 | High |

#### Phase 2: データ保存・整理

| ID | 要件名 | 優先度 |
|----|-------|-------|
| REQ-009 | フォルダ自動生成機能 | High |
| REQ-010 | ファイル保存機能 | High |
| REQ-011 | 履歴保存（レジュメ）機能 | Medium |
| REQ-016 | 成果物一括保存機能 | High |
| REQ-017 | 保存前バリデーション機能 | High |

#### Phase 3: メディア連携

| ID | 要件名 | 優先度 |
|----|-------|-------|
| REQ-012 | 画像プロンプト生成機能 | Medium |
| REQ-013 | 画像アップロード機能 | Medium |
| REQ-014 | スライド構成プロンプト生成機能 | Medium |
| REQ-015 | PDFアップロード機能 | Medium |
| REQ-018 | manifest.json生成機能 | Medium |
| REQ-019 | 状態リセット機能 | Medium |
